<!DOCTYPE html>
<html lang="en" data-ready="0">

<head>
    <!-- At the top of delete-account.html <body> or in <head> -->
    <script type="module">
        import './firebase-init.js'; // ensures app/auth/db are initialized
    </script>
        
    <!-- 1) FOUC guard: keep page hidden until the right theme is applied -->
    <style>
        html:not([data-ready="1"]) {
            visibility: hidden
        }
    </style>

    <!-- 2) Base paint so Safari/Chrome UI bars don‚Äôt flash wrong colors -->
    <style>
        html,
        body {
            min-height: 100%;
            margin: 0;
            background: var(--bg-color, #fff) !important;
            color: var(--text-color, #111) !important;
        }
    </style>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Welcome to 3-Sides Planner - HOME</title>
    <meta name="description" content="Gentle, themeable planner for tracking mood, routines, and wellness.">

    <!-- PWA -->
    <!-- Absolute (good for GitHub Pages) -->
    <link rel="manifest" href="manifest.webmanifest">
    <!-- Will be live-updated by JS to match your theme -->
    <meta name="theme-color" content="#6a5acd">

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" sizes="any" href="/3-sides-planner.io/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/3-sides-planner.io/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/3-sides-planner.io/favicon-16.png">
    <link rel="apple-touch-icon" href="/3-sides-planner.io/icon-192.png"> <!-- iOS Home screen -->

    <!-- Fonts + CSS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand&family=Open+Sans&family=Patrick+Hand&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="mainTheme.css" />

    <!-- Noscript fallback -->
    <noscript>
        <style>
            html {
                visibility: visible
            }
        </style>
    </noscript>

    <!-- Early Theme Boot: apply saved theme instantly + sync Safari/Android bars -->
    <script>
        (function () {
            try {
                const root = document.documentElement;  
               const userKey = localStorage.getItem("currentUser") || "anon";
                const savedTheme =
                    localStorage.getItem(userKey + ":themeClass") ||
                    localStorage.getItem("themeClass") ||
                    localStorage.getItem("themeClass:last") ||
                    "theme-original";

                // Apply only the theme-* class; keep any other classes on <html>
                const keep = (root.className || "").split(/\s+/).filter(Boolean).filter(c => !c.startsWith("theme-"));
                root.className = [...keep, savedTheme].join(" ");

                // Keep browser UI bars in sync (Safari/Android)
                const meta = document.querySelector('meta[name="theme-color"]') || (function () {
                    const m = document.createElement('meta'); m.name = 'theme-color'; document.head.appendChild(m); return m;
                })();
                const cs = getComputedStyle(root);
                meta.content = (cs.getPropertyValue('--accent-color') || cs.getPropertyValue('--accent') || '#6a5acd').trim() || '#6a5acd';
            } catch { }
        })();
    </script>

    <!-- ===== Page-local styles (your page CSS) ===== -->
    <style>
        .three-d-title {
            font-family: 'Open Sans', sans-serif;
            font-size: 2.2rem;
            font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px rgba(0, 0, 0, .2);
            color: var(--text-color) !important;
            margin: .25rem 0 .5rem 0;
        }

        /* Layout */
        .container {
            padding: 1rem;
            margin: 0 auto;
            width: 95vw;
            max-width: 600px;
            box-sizing: border-box;
        }

        body {
            overflow-x: hidden;
        }

        body {
            background-color: var(--bg-color) !important;
            color: var(--text-color) !important;
        }

        .button,
        .popup {
            background-color: var(--accent-color) !important;
            color: var(--text-color) !important;
        }

        /* Auth bar */
        #authControls {
            margin-bottom: 0;
            padding-bottom: 0
        }

        #authControls p {
            margin: 0;
            padding: 0
        }

        .auth-button {
            border: 1px solid #000;
            display: inline-block;
            background: rgb(221, 151, 221);
            color: #000;
            padding: .5rem 1.2rem;
            border-radius: 1.5rem;
            font-weight: 700;
            font-size: 1rem;
            text-decoration: none;
            margin: 0 .5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, .1);
            transition: background-color .3s ease;
        }

        .auth-button:hover {
            background: #983d9d
        }

        /* logout button */
        #authControls button {
            background: rgb(221, 151, 221);
            color: #000;
            padding: .5rem 1.2rem;
            border: 1px solid #000;
            border-radius: 1.2rem;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color .3s ease;
        }

        #authControls button:hover {
            background: #983d9d
        }

        /* Keep text themed in details */
        .dropdown-section details p {
            color: black !important
        }

        @media (max-width:600px) {
            body {
                padding: 0 1rem;
                box-sizing: border-box;
            }
        }

        /* Image hero box */
        .image-text-box {
            background: rgb(3, 3, 82);
            padding: 1.5rem 1rem;
            margin: 2rem 0;
            box-sizing: border-box;
            border-top: 2px solid #000;
            border-bottom: 2px solid #000;
            width: 100%;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .hero-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }

        @media (max-width:600px) {
            .image-text-box {
                width: 100%;
                max-width: 100%;
                margin-left: 0;
                margin-right: 0;
                border-radius: 0;
                padding: 1rem .75rem;
                /* fixed split line */
                text-align: left;
            }

            .hero-image {
                width: 100%;
                height: auto;
                max-width: 600px;
                display: block;
                margin: 0 auto;
                border-radius: 10px;
            }

            .hero-caption,
            .image-text-box p {
                font-size: 1rem;
                line-height: 1.4;
            }
        }

        strong {
            color: var(--text-color);
            font-size: 33px;
            font-weight: bolder;
        }

        /* Full-height layout + bottom space for footer */
        html,
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            box-sizing: border-box;
            width: 100%;
            padding-bottom: 4rem;
            /* room for bottom nav */
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        /* ==================== sparkles ==================== */
        #sparkleWrapper {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden
        }

        .sparkle {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, .9) 0%, transparent 70%);
            opacity: 0;
            animation: spark 3.6s infinite ease-in-out;
            box-shadow: 0 0 6px rgba(255, 255, 255, .5)
        }

        @keyframes spark {

            0%,
            100% {
                opacity: .08;
                transform: scale(.6)
            }

            50% {
                opacity: 1;
                transform: scale(1.25)
            }
        }

        @media (prefers-reduced-motion:reduce) {
            .sparkle {
                animation: none;
                opacity: .18
            }
        }
    </style>

    <!-- Service worker registration -->
    <script src="sw-register.js"></script>

    <!-- BFCache reveal: if the page is restored from cache, make it visible -->
    <script>
        window.addEventListener("pageshow", function (e) {
            if (e.persisted) {
                document.documentElement.setAttribute("data-ready", "1");
                document.documentElement.style.visibility = "visible";
            }
        });
    </script>
</head>

<body>
    <!-- ============= page sparkles ============ -->
    <div class="full-page-sparkle-wrapper" id="sparkleWrapper"></div>

    <!-- üîê Auth bar rendered by script -->
    <div id="authControls" class="auth-buttons"></div>

    <!-- üå∏ Redesigned Top Section -->
    <div class="page-header">
        <h1 class="three-d-title">‚ñÄ‚ñÑ‚ñÄ‚ñÑ‚ñÄ‚ñÑ Ôºì-‚ì¢‰∏®ƒëÔΩÖùï§ ∆§lùêöŒ∑ùïü—î≈ò ‚ñÑ‚ñÄ‚ñÑ‚ñÄ‚ñÑ‚ñÄ</h1>

        <div class="image-text-box">
            <img src="relax.png" alt="Relaxing mental health image" class="hero-image">
            <br>
            <p class="hero-caption">
                When we or someone we love is living with bipolar disorder, it‚Äôs important to pause and ask: <em>What is
                    bipolar?</em>
            </p>

        </div>
        <p
            style="font-family: 'Open Sans', sans-serif; font-size: 1.4rem; font-weight: 600; color: var(--text-color); padding: 0 1.0rem;">
            <strong>3-Sides</strong> represents the emotional shifts of bipolar life: the highs, the lows, and the
            moments of
            balance. This planner helps you make sense of it all, one day at a time.
        </p>

        <div class="cloud-section intro-paragraph"></div>

        <div class="dropdown-section">
            <p style="font-family: 'Open Sans', sans-serif; font-size: 1.4rem; font-weight: 600;">
                üé≠ Understanding Bipolar üé≠: Your questions, answered.
            </p>

            <details>
                <summary>üåø Stability</summary>
                <p>Stability is the sweet spot ‚Äî when your mood is balanced, your thoughts are clear, and you feel
                    grounded.
                    You‚Äôre able to enjoy your life, stick to routines, manage stress, and connect with people in a
                    steady way.
                    Stability isn‚Äôt about being perfect ‚Äî it‚Äôs about feeling more like yourself. It‚Äôs the calm in the
                    middle of
                    the storm, the feeling that you can breathe fully again without fear of the next swing. During
                    stable periods,
                    you may find it easier to build healthy habits, follow through on plans, and reflect on past
                    episodes with
                    more clarity. This is a powerful time for self-awareness and growth. It‚Äôs also when your support
                    tools ‚Äî like
                    this app ‚Äî can be fine-tuned to prepare for future highs or lows. The goal of this app is to help
                    you stay in
                    this place as much as possible, and return here gently and safely when you‚Äôre not. Stability
                    deserves
                    celebration ‚Äî not because it means everything is perfect, but because it means you‚Äôre at peace,
                    moving forward
                    one steady step at a time.</p>
            </details>

            <details>
                <summary>üåû Mania</summary>
                <p>Mania can feel like a superpower. You might feel unstoppable ‚Äî bursting with energy, creativity,
                    confidence,
                    and big ideas that seem to flow faster than you can keep up with. At first, it might feel exciting,
                    even
                    euphoric. You may find yourself starting new projects, talking a mile a minute, making bold plans,
                    or feeling
                    like everything is finally falling into place. But mania isn‚Äôt just about feeling good ‚Äî it can also
                    come with
                    serious risks. You might sleep very little and still feel wired, take impulsive actions like
                    overspending,
                    driving too fast, hypersexuality, or starting risky relationships. You might feel unusually
                    irritable or
                    defensive when others question you, or like you're on a mission and no one can slow you down. The
                    thing about
                    mania is that it often sneaks in quietly, feeling helpful or powerful at first, which is why it‚Äôs so
                    important
                    to learn your early signs and triggers. Recognizing those signs ‚Äî even the subtle ones ‚Äî can help
                    you act
                    before things spiral. This planner can be a tool for spotting patterns, staying grounded, and
                    reaching out for
                    support when needed. You deserve stability, and having a plan in place is a powerful act of
                    self-love and
                    protection.</p>
            </details>

            <details>
                <summary>üå§Ô∏è Hypomania</summary>
                <p>Hypomania is like mania‚Äôs quieter cousin. It can feel like a burst of sunshine after a long storm ‚Äî
                    your mind
                    feels sharp, your energy is up, and you might feel more social, creative, or productive than usual.
                    Unlike
                    full mania, hypomania doesn‚Äôt typically cause major disruptions in your life ‚Äî you may still be
                    going to work
                    or keeping up with your responsibilities. In fact, it can feel really good. But it‚Äôs also easy to
                    miss or
                    dismiss, especially because it can feel like ‚Äújust having a good day.‚Äù The challenge is that
                    hypomania can
                    escalate into full-blown mania or crash into depression if not recognized early. Tracking your
                    sleep, energy,
                    and behavior during these times can help you catch it before it tips too far. Knowing your early
                    signs gives
                    you the power to pause, reflect, and protect your stability before things spiral.</p>
            </details>

            <details>
                <summary>üåßÔ∏è Depression</summary>
                <p>Bipolar depression is more than just feeling sad ‚Äî it's like a fog that settles over everything. It‚Äôs
                    a deep,
                    persistent heaviness that can make even the simplest tasks feel overwhelming. You might feel numb,
                    hopeless,
                    or weighed down by sadness. It can show up as a lack of energy, loss of interest in things you used
                    to enjoy,
                    or feeling disconnected from the people around you. Even things like eating, showering, or getting
                    out of bed
                    might feel too difficult. Depression can also come with negative thoughts that lie to you ‚Äî telling
                    you you're
                    a burden, that you're not enough, or that things will never get better. These thoughts are part of
                    the
                    illness, not the truth. Guilt and shame often tag along, especially if you‚Äôve been in a productive
                    or "high"
                    state before and now feel like you‚Äôve crashed. It‚Äôs important to remember: depression is not your
                    fault. It
                    doesn‚Äôt mean you‚Äôre weak or lazy ‚Äî it means your brain is going through something heavy. Recognizing
                    your
                    early warning signs, having a safety plan, and checking in with your support system can make a huge
                    difference. Even if you can‚Äôt see it right now, you are not alone, and this low will not last
                    forever. This
                    planner is here to help you document your patterns, reflect gently, and remind yourself that healing
                    is
                    possible, one step at a time.</p>
            </details>

            <details>
                <summary>üòµ‚Äçüí´ Mixed Episodes</summary>
                <p>Mixed states are when symptoms of mania and depression show up at the same time. You might feel
                    extremely
                    agitated or restless, but also hopeless and low. You could be full of energy but filled with despair
                    ‚Äî crying
                    while your mind is racing. These episodes are often the most dangerous because you may feel
                    impulsive and
                    hopeless at once, which can lead to risky choices or thoughts of self-harm. They‚Äôre hard to
                    recognize and even
                    harder to explain. This app can help you track overlapping feelings, so you‚Äôre more equipped to spot
                    when
                    you‚Äôre not ‚Äújust anxious‚Äù or ‚Äújust sad‚Äù ‚Äî you‚Äôre in a mixed state, and you deserve support.</p>
            </details>

            <details>
                <summary>üå™Ô∏è Rapid Cycling</summary>
                <p>Rapid cycling is when mood episodes ‚Äî like mania, hypomania, or depression ‚Äî happen more often than
                    usual.
                    Instead of lasting for weeks or months, these shifts can happen in just days or even hours. You
                    might feel
                    like you're constantly flipping between emotional states, never getting a break to catch your
                    breath. This can
                    feel exhausting, confusing, and hard to explain to others. If you've ever felt like your mood
                    changes ‚Äútoo
                    fast‚Äù to be taken seriously, know that you are not imagining it. Rapid cycling is real, and it's
                    more common
                    in some people with bipolar than others. It doesn‚Äôt make your experience less valid ‚Äî it just means
                    your
                    emotional shifts happen more quickly. Tracking your moods, patterns, and triggers in this app can
                    help you
                    notice those shifts sooner and feel more prepared. You're not broken ‚Äî your brain is just moving
                    through
                    cycles at a different rhythm.</p>
            </details>
        </div>

        <footer class="bottom-nav">
            <a href="index.html" class="nav-icon">üè†<span>Home</span></a>
            <a href="toolkit-hub.html" class="nav-icon">üß∞<span>Toolkit</span></a>
            <a href="wellness.html" class="nav-icon">üíñ<span>Wellness</span></a>
            <a href="pet.html" class="nav-icon">üêæ<span>Pet</span></a>
            <a href="important-numbers.html" class="nav-icon">üÜò<span>Help</span></a>
            <a href="theme.html" class="nav-icon" data-auth="true">üé®<span>Themes</span></a>
        </footer>


        <!-- ====================== SCRIPT ====================== -->
        <script type="module">
            import { auth, db } from "./firebase-init.js";
            import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
            import { doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
            import { signOutUser } from "./auth.js";

            const html = document.documentElement;

            const show = () => {
                html.setAttribute("data-ready", "1");
                html.style.visibility = "visible";
            };

            function syncMetaTheme() {
                try {
                    const cs = getComputedStyle(document.documentElement);
                    const accent =
                        (cs.getPropertyValue("--accent-color") ||
                            cs.getPropertyValue("--accent") ||
                            "#6a5acd")
                            .trim() || "#6a5acd";
                    const meta = document.querySelector('meta[name="theme-color"]');
                    if (meta) meta.content = accent;
                } catch { }
            }

            function applyThemeClass(themeClass) {
                const root = document.documentElement;
                const next = themeClass || "theme-original";

                // keep non-theme classes; swap only theme-*
                const keep = (root.className || "")
                    .split(/\s+/).filter(Boolean)
                    .filter(c => !c.startsWith("theme-"));

                const curr = (root.className.match(/\btheme-[^\s]+/g) || [])[0];
                if (curr === next) { syncMetaTheme(); return; }

                root.className = [...keep, next].join(" ");

                // persist for next boot (scoped by currentUser when present)
                try {
                    const userKey = localStorage.getItem("currentUser") || "anon";
                    localStorage.setItem(userKey + ":themeClass", next);
                    localStorage.setItem("themeClass:last", next);
                } catch { }

                syncMetaTheme();
            }

            function renderLoggedOutUI() {
                const host = document.getElementById("authControls");
                if (host) host.innerHTML = `<a class="auth-button" href="login.html">Log in</a>`;
            }

            function renderLoggedInUI(user) {
                const host = document.getElementById("authControls");
                if (!host) return;
                const name = user.displayName || (user.email?.split("@")[0]) || "User";
                host.innerHTML = `
                        <span class="hello">üëã Hello, <strong>${name}</strong></span>
                        <button id="logoutBtn" type="button">Logout</button>
                      `;
                document.getElementById("logoutBtn")?.addEventListener("click", () => signOutUser());
            }

            // Gate links like <a href="theme.html" data-auth="true">
            function guardLinks(isAuthed) {
                document.querySelectorAll('[data-auth="true"]').forEach(a => {
                    if (isAuthed) {
                        a.onclick = null;
                    } else {
                        a.onclick = (e) => {
                            e.preventDefault();
                            const dest = a.getAttribute("href") || "index.html";
                            location.href = `login.html?next=${encodeURIComponent(dest)}`;
                        };
                    }
                });
            }

            let unsub = null;

            onAuthStateChanged(auth, (user) => {
                if (unsub) { unsub(); unsub = null; }

                if (!user) {
                    // Logged out ‚Üí reset theme to base + clear user marker
                    try {
                        localStorage.removeItem("currentUser");
                        localStorage.setItem("themeClass:last", "theme-original");
                    } catch { }
                    applyThemeClass("theme-original");

                    renderLoggedOutUI();
                    guardLinks(false);
                    show();
                    return;
                }

                // Logged in ‚Üí live theme from Firestore
                renderLoggedInUI(user);
                guardLinks(true);

                let first = true;
                unsub = onSnapshot(
                    doc(db, "users", user.uid),
                    (snap) => {
                        const t = snap.exists() ? (snap.data()?.themeClass || "") : "";
                        if (t) applyThemeClass(t); else syncMetaTheme();
                        if (first) { show(); first = false; }
                    },
                    (err) => {
                        console.error("[index] theme snapshot error:", err);
                        // Even if Firestore fails, don't block the page
                        syncMetaTheme();
                        show();
                    }
                );
            });

            // BFCache hygiene: if the tab is put to sleep, clear the ready flag
            window.addEventListener("pagehide", () => { html.removeAttribute("data-ready"); });
        </script>
          
       <script>
        // If our module never runs (CDN blocked/offline), reveal the page anyway.
        setTimeout(() => {
            const html = document.documentElement;
            if (html.getAttribute('data-ready') !== '1') {
                html.setAttribute('data-ready', '1');
                html.style.visibility = 'visible';
            }
        }, 1500);
    </script>
      
</body>

</html>